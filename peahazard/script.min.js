const DIFFICULTY={NORMAL:1,HARD:2},STAMINA_MAX={1:100,2:50},MAX_ENEMY_SIZE={1:200,2:400},MAX_BALLET_ITEM_SIZE={1:4,2:4},MAX_SCORE_ITEM_SIZE={1:10,2:10},DEFAULT_BALLET_SIZE={1:10,2:10},FOLLOWING_ENEMY_PROB={1:20,2:8},INITIAL_ENEMY_SIZE={1:50,2:200},INITIAL_BALLET_ITEM_SIZE={1:5,2:10},INITIAL_SCORE_ITEM_SIZE={1:5,2:5},ENEMY_GENERATE_TIME={1:40,2:30},SCORES={pumpkin:100,candy:200},ANIMATION_FRAME=6,GAME_KEY={up:"ArrowUp",down:"ArrowDown",right:"ArrowRight",left:"ArrowLeft",ballet:" ",dash:"d"},GAME_STATE={TITLE:1,PLAYING:2,GAME_OVER:3};let assets;const assetsPath={ground:"ground.jpg",chancho:{1:{0:"./img/chancho_10.png",1:"./img/chancho_11.png",2:"./img/chancho_12.png",3:"./img/chancho_13.png",4:"./img/chancho_14.png"},2:{0:"./img/chancho_20.png",1:"./img/chancho_21.png",2:"./img/chancho_22.png",3:"./img/chancho_23.png",4:"./img/chancho_24.png"},3:{0:"./img/chancho_30.png",1:"./img/chancho_31.png",2:"./img/chancho_32.png",3:"./img/chancho_33.png",4:"./img/chancho_34.png"},4:{0:"./img/chancho_40.png",1:"./img/chancho_41.png",2:"./img/chancho_42.png",3:"./img/chancho_43.png",4:"./img/chancho_44.png"}},peanuts:{1:{0:"./img/peanuts_10.png",1:"./img/peanuts_11.png",2:"./img/peanuts_12.png",3:"./img/peanuts_13.png",4:"./img/peanuts_14.png"},2:{0:"./img/peanuts_20.png",1:"./img/peanuts_21.png",2:"./img/peanuts_22.png",3:"./img/peanuts_23.png",4:"./img/peanuts_24.png"},3:{0:"./img/peanuts_30.png",1:"./img/peanuts_31.png",2:"./img/peanuts_32.png",3:"./img/peanuts_33.png",4:"./img/peanuts_34.png"},4:{0:"./img/peanuts_40.png",1:"./img/peanuts_41.png",2:"./img/peanuts_42.png",3:"./img/peanuts_43.png",4:"./img/peanuts_44.png"}},magic:{0:"./img/magic_4.png",1:"./img/magic_3.png",2:"./img/magic_2.png",3:"./img/magic_3.png",4:"./img/magic_4.png"},hit:{0:"./img/explosion_0.png",1:"./img/explosion_1.png",2:"./img/explosion_2.png",3:"./img/explosion_3.png",4:"./img/explosion_4.png",5:"./img/explosion_5.png"},pumpkin:"./img/pumpkin.png",candy:"./img/candy.png",stone:"./img/stone.png",blood:"./img/blood.png",building:"./img/building.png",logo:"./img/logo2.png",ground:"./img/ground.png"},tweetMessage=["ホントはもっとできるナッツ💦","みんなも挑戦ナッツ～！","なんでもないようなスコアが幸せだったと思うでしょう。","ちょっと本気出したナッツ。","みんな上回れるナッツ？"],sounds={scoreup:new Howl({src:["./sound/scoreup.mp3"],volume:.2}),getmagicitem:new Howl({src:["./sound/getmagic.mp3"],volume:.2}),shot:new Howl({src:["./sound/shot.mp3"],volume:.2}),hit:new Howl({src:["./sound/hit.mp3"],volume:.2}),bgm:new Howl({src:["./sound/bgm.mp3"],volume:.5,loop:!0})};class Game{constructor(t,e,i){this.canvas=t,this.ctx=t.getContext("2d"),this.difficulty=i,this.wall=e,this.frame=0,this.movePlayer={x:!1,y:!1},this.score=0,this.remainingBallet=DEFAULT_BALLET_SIZE[this.difficulty],this.keyState=[],this.continuousKey=[],this.stamina=STAMINA_MAX[this.difficulty],this.player=null,this.playing=GAME_STATE.TITLE,this.isMovable=!0}setPlayer(t){this.player=t}process(){this._stamina(),$("#ballet").html(this.remainingBallet),0==this.remainingBallet?$("#ballet").css("color","#FF0000"):$("#ballet").css("color","#000000"),$("#score").html(this.score),this.frame++}_stamina(){this.stamina>0&&this.isDash()?this.stamina=Math.max(this.stamina-1,0):this.stamina<STAMINA_MAX[this.difficulty]&&(this.stamina+=.1);let t=Math.round(this.stamina);$("#stamina").html(t),$("#stamina").css({width:300*t/STAMINA_MAX[DIFFICULTY.NORMAL]+"px"});let e="#07620E";t<30?e="#8E0F06":t<60&&(e="#FFE33E"),$("#stamina").css({background:e})}getDownKeys(){let t=[];for(let e in this.keyState)this.keyState[e]&&t.push(e);return t}getContiunousKeys(){let t=[];for(let e in this.continuousKey)this.continuousKey[e]&&t.push(e);return t}setContinuousKeys(){for(let t in this.keyState)this.keyState[t]&&!this.continuousKey[t]&&(this.continuousKey[t]=!this.continuousKey[t])}isDash(){let t=this.getDownKeys();return t.indexOf(GAME_KEY.dash)>=0&&(t.indexOf(GAME_KEY.right)>=0||t.indexOf(GAME_KEY.left)>=0||t.indexOf(GAME_KEY.up)>=0||t.indexOf(GAME_KEY.down)>=0)}}class AnimationElement{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s,this.isAwake=!0,this.isVisible=!0,this.animationFrame=0}intersects(t){if(!this.isAwake)return;let e=this.x,i=this.x+this.width,s=t.x,a=t.x+t.width,n=this.y,o=this.y+this.height,h=t.y,l=t.y+t.height;return s<i&&a>e&&h<o&&l>n}}class BackgroundElement extends AnimationElement{constructor(t,e,i,s){super(t,e,i,s)}process(t){if(!this.isAwake||!t.isMovable)return;let e=t.getDownKeys();if(0==e.length)return;let i=getMovingDistance(e,t),s=i.deltaX,a=i.deltaY;t.movePlayer.x&&(s=0),this.x+=s,t.movePlayer.y&&(a=0),this.y+=a}}class Background extends BackgroundElement{constructor(t,e,i,s,a){super(t,e,i,s),this.x=-(this.width-a.width)/2,this.y=-(this.height-a.height)/2}process(t){if(!this.isAwake||!t.isMovable)return;let e=t.getDownKeys();if(0==e.length)return;let i=getMovingDistance(e,t),s=this.x+i.deltaX,a=this.y+i.deltaY;t.movePlayer.x||s<-(this.width-t.canvas.width)||s>0?t.movePlayer.x=!0:t.movePlayer.x=!1,t.movePlayer.y||a<-(this.height-t.canvas.height)||a>0?t.movePlayer.y=!0:t.movePlayer.y=!1,super.process(t)}animate(t){this.isVisible&&this._animate(t)}_animate(t){let e=t.ctx;e.beginPath();for(let t=0;t<Math.ceil(this.height/50);t++)for(let i=0;i<Math.ceil(this.width/50);i++)e.drawImage(assets.ground,this.x+50*i,this.y+50*t)}}class BalletItem extends BackgroundElement{constructor(t,e,i,s){super(t,e,i,s)}animate(t){t.ctx.drawImage(assets.stone,this.x,this.y,this.width,this.height)}}class ScoreItem extends BackgroundElement{constructor(t,e,i,s,a){super(t,e,i,s),this.score=SCORES[a],this.type=a}animate(t){t.ctx.drawImage(assets[this.type],this.x,this.y,this.width,this.height)}}class Player extends AnimationElement{constructor(t,e,i,s){super(t,e,i,s),this.direction=1,this.dash=!1}process(t){if(!t.isMovable)return;let e=t.getDownKeys();if(0==e.length)return;let i=getMovingDistance(e,t);if(-1==i.direction)return;this.isDash=i.dash,this.direction=i.direction,this.animationFrame++;let s=Object.keys(assets.chancho[this.direction]).length;if(0==Math.ceil(this.animationFrame/(ANIMATION_FRAME/(this.isDash?2:1)))%(2*(s-1))&&(this.animationFrame=0),t.movePlayer.x){let e=i.deltaX,s=this.x+-e;s<0||s>t.canvas.width-this.width||(s>=(t.canvas.width-this.width)/2&&s<=(t.canvas.width-this.width)/2+this.width&&(t.movePlayer.x=!1),this.x+=-e)}if(t.movePlayer.y){let e=i.deltaY,s=this.y+-e;s<0||s>t.canvas.height-this.height||(s>=(t.canvas.height-this.height)/2&&s<=(t.canvas.height-this.height)/2+this.height&&(t.movePlayer.y=!1),this.y+=-e)}}animate(t){let e,i=Object.keys(assets.chancho[this.direction]).length,s=Math.ceil(this.animationFrame/(ANIMATION_FRAME/(this.isDash?2:1)))%(2*(i-1));e=s<Math.ceil(i/2)?s+2:6-s<0?s-6:6-s;var a=assets.chancho[this.direction][e];t.ctx.drawImage(a,this.x-15,this.y-40,50,80)}}class Enemy extends BackgroundElement{constructor(t,e,i,s){super(t,e,i,s),this.direction=1}animate(t){this.isVisible&&this._animate(t)}_animate(t){let e,i=t.ctx,s=Object.keys(assets.peanuts[this.direction]).length,a=Math.ceil(this.animationFrame/ANIMATION_FRAME)%(2*(s-1));e=a<Math.ceil(s/2)?a+2:6-a<0?a-6:6-a;var n=assets.peanuts[this.direction][e];i.drawImage(n,this.x,this.y-20,50,80)}}class RandomWalkEnemy extends Enemy{constructor(t,e,i,s){super(t,e,i,s),this.direction=randInt(1,4),this.frame=120,this.wait=!1}process(t){super.process(t);let e=Math.pow(this.x-t.player.x,2),i=Math.pow(this.y-t.player.y,2);if(this.animationFrame++,e+i<Math.pow(150,2))return this.x-t.player.x>0?(this.x-=1,this.direction=2):(this.x+=1,this.direction=1),void(this.y-t.player.y>0?(this.y-=1,e<i&&(this.direction=4)):(this.y+=1,e<i&&(this.direction=3)));if(120==this.frame){this.frame=0;let t=randInt(1,6);t<=4?(this.direction=t,this.wait=!1):this.wait=!0}if(this.frame++,this.wait)return void this.animationFrame--;let s=Object.keys(assets.peanuts[this.direction]).length;0==Math.ceil(this.animationFrame/ANIMATION_FRAME)%(2*(s-1))&&(this.animationFrame=0);let a=this.__getDeltaXY(this.direction),n=this.x+a.deltaX,o=this.y+a.deltaY;1!=this.direction&&2!=this.direction||!(n<t.wall.x||n>t.wall.x+t.wall.width-this.width)||(this.direction=3-this.direction,a.deltaX*=-1,this.frame=0),3!=this.direction&&4!=this.direction||!(o<t.wall.y||o>t.wall.y+t.wall.height-this.height)||(this.direction=7-this.direction,a.deltaY*=-1,this.frame=0),this.x+=a.deltaX,this.y+=a.deltaY}__getDeltaXY(t){let e=0,i=0;switch(t){case 1:e=1.5;break;case 2:e=-1.5;break;case 3:i=1.5;break;case 4:i=-1.5}return{deltaX:e,deltaY:i}}}class FollowingEnemy extends Enemy{process(t){super.process(t),this.animationFrame++;let e=Object.keys(assets.peanuts[this.direction]).length;0==Math.ceil(this.animationFrame/ANIMATION_FRAME)%(2*(e-1))&&(this.animationFrame=0);let i=Math.abs(this.x-t.player.x),s=Math.abs(this.y-t.player.y);this.x-t.player.x>0?(this.x-=1,this.direction=2):(this.x+=1,this.direction=1),this.y-t.player.y>0?(this.y-=1,i<s&&(this.direction=4)):(this.y+=1,i<s&&(this.direction=3))}}class Ballet extends BackgroundElement{constructor(t,e,i,s,a){super(t,e,i,s),this.direction=a}process(t){super.process(t),this.animationFrame++;let e=Object.keys(assets.magic).length;if(0==Math.ceil(this.animationFrame/ANIMATION_FRAME)%(2*(e-1))&&(this.animationFrame=0),this.x<t.wall.x-this.width||this.x>t.wall.x+t.wall.width||this.y<t.wall.y-this.height||this.y>t.wall.y+t.wall.height)return this.isAwake=!1,void(this.isVisible=!1);switch(this.direction){case 1:this.x+=10;break;case 2:this.x-=10;break;case 3:this.y+=10;break;case 4:this.y-=10}}animate(t){let e,i=t.ctx,s=Object.keys(assets.magic).length,a=Math.ceil(this.animationFrame/ANIMATION_FRAME)%(2*(s-1));e=a<Math.ceil(s/2)?a+2:6-a<0?a-6:6-a;var n=assets.magic[e];i.drawImage(n,this.x,this.y,this.width,this.height)}intersects(t){let e=0,i=0,s=0,a=0;if(!this.isVisible)switch(e=i=.7*this.width,s=a=.7*this.height,this.direction){case 1:e=0,i*=1.5,s/=2,a/=2;break;case 2:e*=1.5,i=0,s/=2,a/=2;break;case 3:e/=2,i/=2,s=0,a*=1.5;break;case 4:e/=2,i/=2,s*=1.5,a=0}let n=this.x-e,o=this.x+this.width+i+e,h=t.x,l=t.x+t.width,r=this.y-s,c=this.y+this.height+a+s,m=t.y,g=t.y+t.height;return h<o&&l>n&&m<c&&g>r}}class BonusAnimation extends BackgroundElement{constructor(t,e,i,s,a,n,o){super(t,e,i,s),this.text=a,this.fontSize=n,this.color=o}process(t){if(super.process(t),this.animationFrame>100)return this.isVisible=!1,void(this.isAwake=!1);this.y-=.5,"MPぎれ"==this.text&&(this.x=t.player.x-30,this.y=t.player.y-50),this.animationFrame++}animate(t){if(!this.isVisible)return;let e=t.ctx;e.font=this.fontSize+"px DotFont";let i=this.animationFrame>=40?(50-this.animationFrame)/10:1;e.fillStyle="rgba("+this.color.r+","+this.color.g+","+this.color.b+","+i+") ",e.fillText(this.text,this.x,this.y,this.width,this.height)}}class KillAnimation extends BackgroundElement{process(t){if(super.process(t),++this.animationFrame/ANIMATION_FRAME==Object.keys(assets.hit).length)return this.isVisible=!1,void(this.isAwake=!1)}animate(t){if(!this.isVisible)return;let e=t.ctx,i=Math.floor(this.animationFrame/ANIMATION_FRAME);var s=assets.hit[i];e.drawImage(s,this.x,this.y,this.width,this.height)}}class SampleAnimation extends BackgroundElement{animate(t){let e=t.ctx;e.strokeStyle="#FFFFFF",e.strokeRect(this.x,this.y,this.width,this.height)}}function getMovingDistance(t,e){let i=0,s=0,a=-1;t.indexOf(GAME_KEY.right)>=0&&(i-=3,a=1),t.indexOf(GAME_KEY.left)>=0&&(i+=3,a=2),t.indexOf(GAME_KEY.down)>=0&&(s-=3,a=3),t.indexOf(GAME_KEY.up)>=0&&(s+=3,a=4);let n=t.indexOf(GAME_KEY.dash)>=0;return n&&Math.round(e.stamina)>0&&(i*=2,s*=2),{deltaX:i,deltaY:s,direction:a,dash:n}}function randInt(t,e){return Math.round(Math.random()*(e-t))+t}function loadAssets(t){for(let e in t){let i,s=t[e];"string"==typeof s?((i=new Image).src=s,i.onload=function(t){}):i=loadAssets(s),t[e]=i}return t}function selectMessage(t,e){let i=[1500,3e3];return t==DIFFICULTY.HARD&&(i=[1e3,2e3]),e<i[0]?tweetMessage[randInt(0,2)]:e<i[1]?tweetMessage[3]:tweetMessage[4]}let loaded=!1,videoLoaded=!1;$(function(){init(),loaded=!0}),$(window).on("load",function(){let t=setInterval(function(){loaded&&videoLoaded&&(clearInterval(t),console.log("読み込み完了"),showTitle())},500)});var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];let youtubePlayer,game,canvas;function onYouTubeIframeAPIReady(){youtubePlayer=new YT.Player("player",{height:"0",width:"0",videoId:"2Hqq7BPUmrk",events:{onReady:function(){youtubePlayer.playVideo(),youtubePlayer.pauseVideo(),videoLoaded=!0}}})}function init(){hideGameInfo(),canvas=document.getElementById("maincanvas"),$('<div id="loading"><div class="loading"></div></div>').prependTo("#game-player"),assets=loadAssets(assetsPath)}function setKeyEvent(){document.onkeydown=(t=>{game.keyState[t.key]=!0}),document.onkeyup=(t=>{game.keyState[t.key]=!1,game.continuousKey[t.key]=!1})}function start(t){t==DIFFICULTY.HARD?youtubePlayer.setPlaybackRate(1.25):youtubePlayer.setPlaybackRate(1),$("#info").show(),sounds.bgm.stop();let e=[],i=[],s=[],a=[],n=[],o=new Background(0,0,2e3,2e3,canvas);(game=new Game(canvas,o,t)).state=GAME_STATE.PLAYING,setKeyEvent();let h=new Player((canvas.width-20)/2,(canvas.height-20)/2,20,20);game.setPlayer(h),e.push(o);for(let t=0;t<INITIAL_ENEMY_SIZE[game.difficulty];t++)s.push(c());for(let t=0;t<INITIAL_SCORE_ITEM_SIZE[game.difficulty];t++)n.push(m("pumpkin"));for(let t=0;t<INITIAL_BALLET_ITEM_SIZE[game.difficulty];t++)a.push(m("ballet"));let l=canvas.getContext("2d");function r(){let t,e;do{t=randInt(o.x+100,o.x+o.width-100)}while(t>=h.x-200&&t<=h.x+200);do{e=randInt(o.y+100,o.y+o.height-100)}while(e>=h.y-200&&e<=h.y+200);return{randomX:t,randomY:e}}function c(){let t=r();return randInt(1,FOLLOWING_ENEMY_PROB[game.difficulty])>1?new RandomWalkEnemy(t.randomX,t.randomY,50,50):new FollowingEnemy(t.randomX,t.randomY,50,50)}function m(t){let e=r();switch(t){case"ballet":return new BalletItem(e.randomX,e.randomY,50,50);case"pumpkin":return new ScoreItem(e.randomX,e.randomY,80,80,"pumpkin");case"candy":return new ScoreItem(e.randomX,e.randomY,80,80,"candy")}}requestAnimationFrame(function t(o){playVideo();let r=e.length;for(let t=0;t<r;t++){let i=e[t];i.process(game),i.isVisible||(e.splice(t,1),r--,t--)}let g=a.length;for(let t=0;t<g;t++){let i=a[t];if(h.intersects(i)){game.remainingBallet+=DEFAULT_BALLET_SIZE[game.difficulty]/2,i.isVisible=!1;let t=new BonusAnimation(i.x+10,i.y,50,10,"MP +5",20,{r:255,g:255,b:255});t.process(game),e.push(t),sounds.getmagicitem.play()}i.process(game),i.isVisible||(a.splice(t,1),g--,t--)}let d=n.length;for(let t=0;t<d;t++){let i=n[t];if(h.intersects(i)){game.score+=i.score,i.isVisible=!1;let t=new BonusAnimation(i.x+10,i.y,80,20,"+"+i.score,30,{r:255,g:255,b:255});t.process(game),e.push(t),sounds.scoreup.play()}i.process(game),i.isVisible||(n.splice(t,1),d--,t--)}let u=s.length,p=i.length;for(let t=0;t<p;t++){let a=i[t];for(let t=0;t<u;t++){let i=s[t];if(a.intersects(i)){if(a.isVisible){a.isVisible=!1,sounds.hit.play(),t=-1;continue}let s=new KillAnimation(i.x-30,i.y-30,100,100);e.push(s),i.isVisible=!1}}}for(let t=0;t<u;t++){let e=s[t];if(e.isVisible){if(e.process(game),h.intersects(e)){game.state=GAME_STATE.GAME_OVER;break}}else s.splice(t,1),u--,t--}if(game.frame%ENEMY_GENERATE_TIME[game.difficulty]==0&&u<MAX_ENEMY_SIZE[game.difficulty]&&s.push(c()),game.frame%360==0&&a.length<MAX_BALLET_ITEM_SIZE[game.difficulty]&&a.push(m("ballet")),game.frame%360==0&&n.length<MAX_SCORE_ITEM_SIZE[game.difficulty]){let t=randInt(1,5)>1?m("pumpkin"):m("candy");n.push(t)}if(game.remainingBallet>0&&game.getDownKeys().indexOf(GAME_KEY.ballet)>=0&&-1==game.getContiunousKeys().indexOf(GAME_KEY.ballet)&&(sounds.shot.play(),i.push(new Ballet(h.x-20,h.y-40,80,80,h.direction)),game.remainingBallet--,0==game.remainingBallet)){let t=new BonusAnimation(h.x-20,h.y-50,80,20,"MPぎれ",30,{r:255,g:0,b:0});t.process(game),e.push(t)}for(let t=0;t<p;t++){let e=i[t];e.process(game),e.isAwake&&e.isVisible||(i.splice(t,1),p--,t--)}h.process(game),game.process(),l.clearRect(0,0,canvas.width+100,canvas.height+100);for(let t=0;t<r;t++)e[t].isAwake||(e.splice(t,1),t--,r--);for(let t=0;t<e.length;t++)e[t].animate(game);for(let t=0;t<a.length;t++)a[t].animate(game);for(let t=0;t<n.length;t++)n[t].animate(game);h.animate(game);for(let t=0;t<s.length;t++)s[t].animate(game);for(let t=0;t<i.length;t++)i[t].animate(game);switch(game.setContinuousKeys(),game.state){case GAME_STATE.PLAYING:requestAnimationFrame(t);break;case GAME_STATE.GAME_OVER:gameover(),console.log("GAME OVER")}})}function showTitle(){hideGameInfo(),$("#modal-gameover").hide(),$("#loading").fadeOut(200);let t=canvas.getContext("2d");t.clearRect(0,0,canvas.width,canvas.height),t.fillStyle="#520057",t.fillRect(0,0,canvas.width,canvas.height),t.drawImage(assets.blood,0,0,500,500),t.drawImage(assets.building,550,180,450,400),t.drawImage(assets.chancho[1][1],50,300,200,300),t.drawImage(assets.peanuts[2][1],730,200,250,400),t.drawImage(assets.logo,200,50,600,300),t.font="40px DotFont",t.fillStyle="#ffffff",t.fillText("click to start",350,450,500,100),$("#maincanvas").on("click",function(){$("#maincanvas").off("click"),showScreenExplanation()})}function showScreenExplanation(){sounds.bgm.play(),hideGameInfo(),$("#select-difficulty").show();let t=canvas.getContext("2d");t.clearRect(0,0,canvas.width,canvas.height),t.fillStyle="#520057",t.fillRect(0,0,canvas.width,canvas.height),t.drawImage(assets.blood,0,0,500,500),t.drawImage(assets.building,550,180,450,400);let e=["ゾンビピーナッツくんからにげながら","カボチャやアメをひろってハイスコアをめざそう！","まほうをうつとゾンビピーナッツくんをたおせるよ！","まほうの石を1コひろうと5回ぶんのまほうが","かいふくできるよ！"];for(let i=0;i<e.length;i++)t.fillStyle="#FFFFFF",t.font="30px DotFont",t.fillText(e[i],150,40*(i+1)+30,800,500);let i=["↑↓←→キー: いどう","dキー+いどう: ダッシュ。つかうとスタミナがへるよ。","スペースキー: まほうはっしゃ"];for(let e=0;e<i.length;e++)t.fillStyle="#FFFFFF",t.font="30px DotFont",t.fillText(i[e],150,40*(e+1)+250,800,500);$(".normal").on("click",function(){$(".normal").off("click"),$(".hard").off("click"),$("#select-difficulty").hide(),start(DIFFICULTY.NORMAL)}),$(".hard").on("click",function(){$(".normal").off("click"),$(".hard").off("click"),$("#select-difficulty").hide(),start(DIFFICULTY.HARD)})}function gameover(){document.onkeydown=null,document.onkeyup=null,hideGameInfo(),youtubePlayer.pauseVideo(),$("#modal-gameover #result span").html(game.score),$("#modal-gameover").show();let t=game.difficulty==DIFFICULTY.NORMAL?"NORMAL":"VERY HARD";$("#modal-gameover a").attr("href","https://twitter.com/intent/tweet?text=🥜🥜🥜🥜🥜🥜🥜🥜🥜🥜🥜%0A≪"+t+"≫で%0A≪"+game.score+"点≫獲ったナッツ！%0A"+selectMessage(game.difficulty,game.score)+"%0A🥜🥜🥜🥜🥜🥜🥜🥜🥜🥜🥜%0A"+encodeURI("https://kawamix.github.io/peahazard/")+"&hashtags=ピーナッツハザード&related=osyarenuts,ponpokoka"),$(".button").on("click",function(){$("#modal-gameover").hide(),$(".button").off("click"),showScreenExplanation()})}function hideGameInfo(){$("#info").hide()}function animateTest(t){let e=[];for(key in keyState)keyState[key]&&e.push(key);$("#state").html([e]),requestAnimationFrame(animateTest)}function playVideo(){switch(youtubePlayer.getPlayerState()){case-1:case 0:case 2:case 5:_playVideo();break;case 1:youtubePlayer.getCurrentTime()>=78.5&&_playVideo()}}function _playVideo(){youtubePlayer.seekTo(34.5),youtubePlayer.setVolume(30),youtubePlayer.playVideo()}firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);